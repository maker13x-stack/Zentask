<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>ZenTask</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4f46e5">

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ZenTask">
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .completed { text-decoration: line-through; opacity: 0.5; }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex justify-center">

  <div class="w-full max-w-5xl p-4">

    <!-- Header -->
    <header class="sticky top-0 bg-white p-4 rounded-xl shadow mb-6 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-600">ZenTask</h1>
      <span id="count" class="bg-indigo-600 text-white px-3 py-1 rounded-full text-sm">0 Tasks</span>
    </header>

    <!-- Add Task -->
    <div class="bg-white p-4 rounded-xl shadow mb-6">
      <div class="grid md:grid-cols-3 gap-3">
        <input id="topic" type="text" placeholder="Task topic"
          class="border p-2 rounded w-full">
        <input id="deadline" type="datetime-local"
          class="border p-2 rounded w-full">
        <button onclick="addTask()"
          class="bg-indigo-600 text-white rounded px-4 py-2 hover:bg-indigo-700">
          Add Task
        </button>
      </div>
    </div>

    <!-- Task Table -->
    <div class="bg-white rounded-xl shadow overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-3 text-left">Topic</th>
            <th class="p-3">Deadline</th>
            <th class="p-3">Countdown</th>
            <th class="p-3">Done</th>
            <th class="p-3">Delete</th>
          </tr>
        </thead>
        <tbody id="taskList"></tbody>
      </table>
    </div>

  </div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function save() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

function addTask() {
  const topic = document.getElementById("topic").value;
  const deadline = document.getElementById("deadline").value;
  if (!topic || !deadline) return alert("Fill all fields");

  tasks.push({
    id: Date.now(),
    topic,
    deadline,
    completed: false,
    completedAt: null
  });

  save();
  render();
  document.getElementById("topic").value = "";
  document.getElementById("deadline").value = "";
}

function toggle(id) {
  const t = tasks.find(x => x.id === id);
  t.completed = !t.completed;
  t.completedAt = t.completed ? Date.now() : null;
  save();
  render();
}

function removeTask(id) {
  tasks = tasks.filter(t => t.id !== id);
  save();
  render();
}

function render() {
  const now = Date.now();
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  tasks = tasks.filter(t =>
    !t.completed || now - t.completedAt < 7 * 24 * 60 * 60 * 1000
  );

  tasks.sort((a,b) => new Date(a.deadline) - new Date(b.deadline));

  tasks.forEach(t => {
    const diff = new Date(t.deadline) - now;
    let countdown = "Overdue";
    if (diff > 0) {
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      countdown = `${h}h ${m}m`;
    }

    list.innerHTML += `
      <tr class="${t.completed ? 'completed' : ''}">
        <td class="p-3">${t.topic}</td>
        <td class="p-3 text-center">${new Date(t.deadline).toLocaleString()}</td>
        <td class="p-3 text-center ${diff < 0 ? 'text-red-600 font-bold' : ''}">
          ${countdown}
        </td>
        <td class="p-3 text-center">
          <input type="checkbox" ${t.completed ? "checked" : ""} onclick="toggle(${t.id})">
        </td>
        <td class="p-3 text-center">
          <button onclick="removeTask(${t.id})" class="text-red-600">âœ•</button>
        </td>
      </tr>`;
  });

  document.getElementById("count").innerText = `${tasks.length} Tasks`;
}

setInterval(render, 60000);
render();

/* Register Service Worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
